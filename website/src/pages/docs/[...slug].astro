---
import { type CollectionEntry } from 'astro:content'
import path from 'path'
import { css } from 'styled-system/css'
import { cx } from 'styled-system/css/cx'
import { prose } from 'styled-system/recipes'
import DocsHero from '~/components/navigation/docs-hero.astro'
import Pre from '~/components/pre.astro'
import DocsLayout from '~/layouts/docs.layout.astro'
import { getAllCollections } from '~/lib/page-control'

type Props = {
  entry: CollectionEntry<'components'> | CollectionEntry<'overview'>
}

export async function getStaticPaths() {
  const collections = await getAllCollections()

  return collections.map((entry) => ({
    params: { slug: path.join(entry.collection, entry.data.id) },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { Content, headings } = await entry.render()
---

<DocsLayout title={entry.data.title} description={entry.data.description} headings={headings}>
  <DocsHero slot="hero" entry={entry} />
  <article class={cx(prose({ size: 'base' }), css({ '& :first-child': { mt: '0' } }))}>
    <Content components={{ pre: Pre }} />
  </article>
</DocsLayout>
